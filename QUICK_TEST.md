# ⚡ 5分钟快速功能测试

## 🎯 测试前准备

```bash
1. Ctrl + R 重启 Obsidian
2. F12 打开开发者工具（查看日志）
3. 创建测试笔记
```

---

## 📝 测试文本

复制以下文本到笔记中：

```
This is the first sentence. This is the second sentence. This is the third sentence. This is the fourth sentence. This is the fifth sentence.
```

---

## ✅ 核心功能测试（2分钟）

### 测试 1: 基础播放 ✅
```
1. 选中所有文本
2. Ctrl + Space
```
**期望结果**：
- ✅ 通知："🔊 Playing 5 sentences"
- ✅ 工具栏出现在顶部
- ✅ 开始播放第一句

**控制台应显示**：
```
[TTSManager] Created 5 chunks
[TTS] Playing chunk: 0/5
```

---

### 测试 2: 文本高亮 ✅
```
播放时观察编辑器
```
**期望结果**：
- ✅ 第一句有紫色背景高亮
- ✅ 播放第二句时，高亮移动到第二句
- ✅ 高亮颜色：rgba(168, 85, 247, 0.3)

**控制台应显示**：
```
[TTS Highlight] 🔆 highlightRange called, from: 0 to: 22
[TTS Highlight] ✅ Highlight effect dispatched!
[TTS Toolbar] ✅ Successfully highlighted chunk: 1/5 (0-22)
```

**❌ 如果没有高亮**：
- 检查控制台是否有 RangeError
- 验证是否看到 highlightRange 日志

---

### 测试 3: 无缝播放 ✅
```
播放时注意句子之间
```
**期望结果**：
- ✅ 第一句播完立即播放第二句
- ✅ 没有明显停顿或延迟
- ✅ 高亮流畅移动

**控制台应显示**：
```
[TTS] 🎯 Using preloaded audio for chunk 1
[TTS] ✅ Preloaded chunk 2
[TTS] ✅ Preloaded chunk 3
```

**❌ 如果有停顿**：
- 检查是否看到 "Using preloaded audio"
- 第一次播放可能慢（需要获取音频）
- 第二次播放应该很快（使用缓存）

---

### 测试 4: 进度条 ✅
```
播放时观察工具栏底部
```
**期望结果**：
- ✅ 看到蓝色细线进度条
- ✅ 从 0% 逐渐增长到 100%
- ✅ 播放第 3 句时显示 60%

---

### 测试 5: 音频可视化器 ✅
```
播放时观察状态区域
```
**期望结果**：
- ✅ 看到 8 个竖条
- ✅ 竖条上下跳动
- ✅ 动画流畅

---

## ⌨️ 快捷键测试（1分钟）

### 测试 6: 暂停/恢复 ✅
```
播放中按 Ctrl + Space
```
**期望结果**：
- ✅ 通知："⏸ Paused"
- ✅ 音频停止
- ✅ 高亮保持

```
再按 Ctrl + Space
```
**期望结果**：
- ✅ 通知："▶ Resumed"
- ✅ 从暂停位置继续
- ✅ 高亮继续

---

### 测试 7: 句子导航 ✅
```
播放中按 Ctrl + →
```
**期望结果**：
- ✅ 通知："⏭ Next sentence"
- ✅ 跳到下一句
- ✅ 高亮立即移动

```
播放中按 Ctrl + ←
```
**期望结果**：
- ✅ 通知："⏮ Previous sentence"
- ✅ 跳回上一句
- ✅ 高亮立即移动

---

### 测试 8: 速度调整 ✅
```
播放中按 Ctrl + ↑
```
**期望结果**：
- ✅ 通知："⚡ Speed: 1.10x"
- ✅ 声音立即变快
- ✅ 无需重新播放

```
播放中按 Ctrl + ↓
```
**期望结果**：
- ✅ 通知："⚡ Speed: 1.00x"
- ✅ 声音立即变慢

---

### 测试 9: 停止 ✅
```
播放中按 Esc
```
**期望结果**：
- ✅ 通知："⏹ Stopped"
- ✅ 音频停止
- ✅ 高亮消失
- ✅ 工具栏可能隐藏（取决于设置）

---

## 🎛️ UI 控制测试（1分钟）

### 测试 10: 自动滚动 ✅
```
1. 选中一段很长的文本（不在屏幕内）
2. 开始播放
3. 点击眼睛图标 👁️
```
**期望结果**：
- ✅ 默认状态：眼睛图标高亮
- ✅ 播放时自动滚动到当前句子
- ✅ 点击后：图标变为 eye-off 🚫
- ✅ 通知："🚫 Autoscroll disabled"
- ✅ 不再自动滚动

```
再次点击眼睛图标
```
**期望结果**：
- ✅ 图标变回 eye 👁️
- ✅ 通知："👁️ Autoscroll enabled"
- ✅ 恢复自动滚动

---

### 测试 11: 速度按钮 ✅
```
点击工具栏的速度按钮（1.0x）
```
**期望结果**：
- ✅ 按钮文字变为 1.25x
- ✅ 音频速度立即改变
- ✅ 继续点击：1.5x → 2.0x → 0.75x → 1.0x

---

## 🔄 缓存测试（1分钟）

### 测试 12: 缓存功能 ✅
```
1. 播放测试文本（第一次）
2. 按 Esc 停止
3. 再次播放相同文本（第二次）
```

**第一次播放 - 控制台应显示**：
```
[TTS] ❌ Cache MISS
[TTS] 🔄 Calling API
[TTS] ✅ API call completed
```

**第二次播放 - 控制台应显示**：
```
[TTS] ✅ Cache HIT
```

**期望结果**：
- ✅ 第一次：稍慢（需要从 API 获取）
- ✅ 第二次：很快（使用缓存）
- ✅ 音频质量相同

---

### 测试 13: 查看缓存 ✅
```
1. 设置 → TTS → Storage
2. 点击 "Refresh" 按钮
```
**期望结果**：
- ✅ 显示缓存大小（例如：1.23 MB）
- ✅ 显示缓存项数量

```
点击 "Clear cache" 按钮
```
**期望结果**：
- ✅ 通知："🗑️ Cleared X cache entries (Y MB)"
- ✅ 缓存大小变为 0.00 MB

---

## ⚠️ 常见问题检查

### 问题 1: 没有高亮 ❌
**检查清单**：
```
1. 控制台是否有错误？
   - RangeError? → 偏移量问题
   - Invalid range? → 位置计算错误

2. 是否看到 highlightRange 日志？
   - 没有？→ 高亮函数未被调用
   - 有？→ CodeMirror 装饰器问题

3. 文本是否在视野内？
   - 尝试滚动到文本位置
   - 关闭自动滚动测试
```

---

### 问题 2: 播放有停顿 ❌
**检查清单**：
```
1. 是否第一次播放？
   - 第一次播放需要获取音频（会慢）
   - 第二次播放应该快（缓存）

2. 控制台是否显示预加载？
   - 应该看到："✅ Preloaded chunk X"
   - 应该看到："🎯 Using preloaded audio"

3. 网络连接是否正常？
   - API 调用可能慢
   - 检查 API Key 是否有效
```

---

### 问题 3: 工具栏不显示 ❌
**检查清单**：
```
1. 设置 → TTS → User Interface
   - "Show player toolbar" 是否设为 "Never"？
   - 改为 "Always"

2. 是否选中了文本？
   - 必须先选中文本才能播放
   - 或按 Ctrl+Space 播放整个文档

3. TTS 是否启用？
   - 设置 → TTS → "Enable TTS"
   - 是否配置了 API Key？
```

---

## 📊 测试结果记录

### 通过的测试
- [ ] 测试 1: 基础播放
- [ ] 测试 2: 文本高亮
- [ ] 测试 3: 无缝播放
- [ ] 测试 4: 进度条
- [ ] 测试 5: 音频可视化器
- [ ] 测试 6: 暂停/恢复
- [ ] 测试 7: 句子导航
- [ ] 测试 8: 速度调整
- [ ] 测试 9: 停止
- [ ] 测试 10: 自动滚动
- [ ] 测试 11: 速度按钮
- [ ] 测试 12: 缓存功能
- [ ] 测试 13: 查看缓存

---

## 🎯 快速评分

| 类别 | 通过数 | 总数 | 状态 |
|------|--------|------|------|
| 核心功能 (1-5) | /5 | 5 | |
| 快捷键 (6-9) | /4 | 4 | |
| UI 控制 (10-11) | /2 | 2 | |
| 缓存 (12-13) | /2 | 2 | |
| **总计** | **/13** | **13** | |

### 评分标准
- ✅ **13/13**: 完美！可以正式使用
- ✅ **11-12/13**: 很好！有小问题但不影响使用
- ⚠️ **9-10/13**: 可用，但需要修复一些问题
- ❌ **< 9/13**: 有重大问题，需要修复

---

## 🚀 下一步

### 如果全部通过 ✅
恭喜！你的 TTS 插件已经：
1. ✅ 完全对齐 Aloud
2. ✅ 所有核心功能正常
3. ✅ 性能优秀
4. ✅ 用户体验良好

**可以开始使用了！** 🎉

### 如果有失败 ❌
1. 📋 记录失败的测试编号
2. 📸 截图错误信息
3. 📝 复制控制台日志
4. 🔍 查看 FEATURE_CHECKLIST.md 详细排查

---

## 📞 获取帮助

### 查看文档
- `FEATURE_CHECKLIST.md` - 完整功能清单
- `TEST_HIGHLIGHT_AND_SEAMLESS.md` - 高亮和无缝播放详细测试
- `AUTOSCROLL_COMPLETE.md` - 自动滚动详细说明
- `IMPROVEMENTS_IMPLEMENTED.md` - 所有改进总结

### 控制台日志
重要的日志关键词：
- ✅ `[TTSManager] Created X chunks`
- ✅ `[TTS Highlight] Highlight effect dispatched`
- ✅ `[TTS] Using preloaded audio`
- ✅ `[TTS] Cache HIT`

不应该出现的错误：
- ❌ `RangeError`
- ❌ `AbortError`
- ❌ `Invalid range`
- ❌ `Offsets out of range`

---

**开始测试吧！祝一切顺利！** 🚀✨
