# 📖 OB-English-Learner 插件全面分析

> 最后更新：2025-12-09  
> 版本：v1.12.0

---

## 📌 插件概述

**OB-English-Learner** 是一个功能强大的 Obsidian 插件，专为英语学习者打造。它将视频学习、AI 辅助、语音识别、文本朗读等功能深度整合到 Obsidian 笔记工作流中，提供完整的语言学习生态系统。

### 核心定位
- 🎯 **目标用户**：英语学习者、内容创作者、播客笔记员
- 🛠️ **核心价值**：自动化学习流程、AI 智能辅助、多模态学习支持
- 🌍 **设计理念**：一站式语言学习工作站

---

## ✨ 功能模块详解

### 1. 🎥 YouTube 视频学习系统

#### 功能描述
自动获取 YouTube/Bilibili 视频字幕，生成双语笔记和 SRT 字幕文件。

#### 核心功能
- ✅ **一键导入**：粘贴视频 URL 即可
- ✅ **自动字幕获取**：无需手动下载字幕
- ✅ **双语生成**：
  - 原文字幕（英文）
  - 译文字幕（中文）
  - 双语对照笔记
- ✅ **智能文本处理**：
  - AI 自动添加标点符号
  - 自动分段（2-4句为一段）
  - 保持原意，不修改内容
- ✅ **资源管理**：
  - 自动下载视频封面
  - 生成 SRT 字幕文件
  - 组织化文件夹结构

#### 使用流程
```
1. 点击左侧 Ribbon 的 🎥 图标（或 Ctrl+Shift+Y）
2. 粘贴 YouTube/Bilibili 视频链接
3. 等待处理（10-60秒，取决于视频长度）
4. 自动生成：
   - 📝 双语笔记（Markdown）
   - 📄 英文字幕（.srt）
   - 📄 中文字幕（.srt）
   - 🖼️ 视频封面（.jpg）
```

#### 生成的笔记结构
```markdown
---
title: 视频标题
author: 频道名称
duration: 视频时长
url: https://youtube.com/watch?v=xxx
---

# 视频标题

## 📊 基本信息
- 作者：XXX
- 时长：XX:XX
- 上传日期：2025-XX-XX

## 📝 内容笔记

### 原文
(AI 格式化后的英文内容，含标点和分段)

### 译文
(AI 翻译的中文内容)
```

---

### 2. 🤖 AI 智能助手系统

#### 2.1 多平台 AI 支持

| AI 服务商 | 模型 | 特点 | 推荐场景 |
|-----------|------|------|----------|
| **DeepSeek** | deepseek-chat, deepseek-reasoner | 快速、性价比高 | 日常翻译、批量处理 |
| **OpenAI** | GPT-4, GPT-3.5 | 高质量、准确 | 重要文档、专业翻译 |
| **Google Gemini** | gemini-2.0-flash-exp, gemini-1.5-pro | 免费、快速 | 测试、轻量使用 |
| **自定义** | 任意兼容 API | 灵活、可控 | 自托管、特殊需求 |

#### 2.2 AI 功能

##### A. 文本格式化
- **作用**：为字幕添加标点符号和段落
- **输入**：原始字幕文本（无标点）
- **输出**：格式化文本（有标点、分段）
- **配置**：可自定义格式化提示词

##### B. 文本翻译
- **作用**：将英文翻译成中文
- **质量**：保持原意，自然流畅
- **支持**：段落级别翻译

##### C. 自定义命令（Custom Commands）
插件内置 7 个 AI 命令，可直接使用：

| 命令 | 功能 | 使用场景 |
|------|------|----------|
| **口语纠正专家** | AI 纠正英语口语表达 | 练习口语、写作 |
| **Summarize** | 总结文本内容 | 快速理解长文 |
| **Fix Grammar** | 修正语法错误 | 写作润色 |
| **Simplify** | 简化复杂表达 | 降低理解难度 |
| **Practice Questions** | 生成练习题 | 巩固学习 |
| **Explain Idioms** | 解释习语俚语 | 理解地道表达 |
| **Translate to Chinese** | 翻译成中文 | 快速翻译 |

**使用方式**：
1. 选中文本
2. 右键 → "English Learner"
3. 选择命令
4. AI 结果自动插入

---

### 3. 🔊 文本转语音（TTS）系统

#### 3.1 支持的服务商

| 服务商 | 特点 | 语音数量 | 音质 |
|--------|------|----------|------|
| **OpenAI** | 自然流畅 | 6种 | ⭐⭐⭐⭐ |
| **Azure** | 多语言、企业级 | 数百种 | ⭐⭐⭐⭐⭐ |
| **ElevenLabs** | 专业级、逼真 | 自定义 | ⭐⭐⭐⭐⭐ |

#### 3.2 播放功能

##### A. 基础播放
- **选中播放**：选中文本 → `Ctrl+Shift+P`
- **从剪贴板播放**：复制文本 → 执行命令
- **导出为音频**：将文本导出为 MP3 文件

##### B. 播放控制
- **快捷键**：
  - `Ctrl+Space` - 播放/暂停
  - `Ctrl+←/→` - 上一句/下一句
  - `Ctrl+↑/↓` - 加速/减速
  - `Escape` - 停止播放
  
- **播放器工具栏**：
  ```
  [▶️ 播放] [⏮️ 上一句] [⏸️ 暂停] [⏭️ 下一句] [👁️ 自动滚动] [🔊 速度] [❌ 关闭]
  ```

##### C. 高级特性
- ✅ **句子级别导航**：自动分句，逐句播放
- ✅ **实时高亮**：当前播放句子粉红色高亮显示
- ✅ **自动滚动**：跟随播放自动滚动到当前句子
- ✅ **速度调节**：0.5x - 2.5x，步进 0.1x
- ✅ **本地缓存**：使用 IndexedDB 缓存音频，减少 API 调用
- ✅ **无缝播放**：预加载下一句，避免卡顿

#### 3.3 音频导出
- **导出格式**：MP3
- **文件命名**：`prefix-hash.mp3`（例：`Now-use-so-and-such-14d3326da.mp3`）
- **保存位置**：`03-Resources/aloud/`
- **插入方式**：自动插入 `![[audio.mp3]]` 到笔记

---

### 4. 🎙️ 语音转文字（STT）系统

#### 4.1 支持的服务商

| 服务商 | 特点 | 准确度 | 语言支持 |
|--------|------|--------|----------|
| **OpenAI Whisper** | 多语言、高准确 | ⭐⭐⭐⭐⭐ | 90+ 语言 |
| **Azure STT** | 企业级、实时 | ⭐⭐⭐⭐ | 100+ 语言 |
| **AssemblyAI** | 英语专精 | ⭐⭐⭐⭐⭐ | 英语 |

#### 4.2 录音功能

##### 使用流程
```
1. 按 Ctrl+Shift+R（或点击 Ribbon 麦克风图标）
2. 开始说话（录音窗口显示波形动画）
3. 点击"停止"按钮
4. 自动转录并插入文本到笔记
```

##### 录音界面
- **位置**：左下角浮动窗口
- **显示内容**：
  - 🎙️ 麦克风图标
  - 📊 实时波形动画
  - ⏱️ 录音时长
  - 🛑 停止按钮

##### 输出格式
```markdown
![[audio-2025-12-09-173059.mp3]]

Transcribed text appears here...
```

#### 4.3 高级特性
- ✅ **音频保存**：可选保存录音文件
- ✅ **格式转换**：支持 WebM → MP3 转换（使用 FFmpeg.wasm）
- ✅ **智能回退**：未配置 STT Key 时自动使用 AI Key

---

### 5. ⚡ 自定义命令系统

#### 5.1 命令管理

##### 命令存储
- **位置**：`03-Resources/copilot-custom-prompts/`
- **格式**：Markdown 文件（.md）
- **结构**：
```markdown
---
showInContextMenu: true
showInSlashMenu: true
order: 1
---

你的命令提示词内容...
支持 {{selection}} 变量
```

##### 命令属性
- `showInContextMenu`：是否显示在右键菜单
- `showInSlashMenu`：是否显示在斜杠命令（未实现）
- `order`：排序优先级
- `modelKey`：绑定的 AI 模型

#### 5.2 命令执行

##### 执行方式
1. **右键菜单**：选中文本 → 右键 → "English Learner" → 选择命令
2. **Ribbon 按钮**：绑定常用命令到工具栏（下文详述）

##### 执行流程
```
1. 用户选中文本
2. 选择命令
3. 插件处理：
   - 替换 {{selection}} 变量
   - 调用 AI API
   - 流式接收响应
4. AI 结果直接插入文档（替换选中内容）
```

---

### 6. 🎯 Ribbon 快捷按钮

#### 6.1 功能说明
在 Obsidian 左侧工具栏添加一个可自定义的快捷按钮，一键执行常用命令。

#### 6.2 配置方法
```
1. Settings → OB English Learner → Commands 标签页
2. 找到"Quick Action Button"卡片
3. 下拉选择要绑定的命令（所有自定义命令）
4. 重新加载 Obsidian（Ctrl+R）
5. 左侧工具栏出现 ⚡ 按钮
```

#### 6.3 使用示例
- **绑定"Translate to Chinese"**：
  1. 选中英文
  2. 点击 ⚡
  3. 中文翻译自动插入
  
- **绑定"口语纠正专家"**：
  1. 选中你的英文表达
  2. 点击 ⚡
  3. 获取纠正建议

---

### 7. ⌨️ 键盘快捷键系统

#### 完整快捷键列表

| 功能分类 | 快捷键 | 功能说明 |
|---------|--------|----------|
| **视频导入** | `Ctrl+Shift+Y` | 打开 YouTube 导入对话框 |
| **语音录音** | `Ctrl+Shift+R` | 开始语音录音 |
| **TTS 播放** | `Ctrl+Shift+P` | 朗读选中的文本 |
| **TTS 控制** | `Ctrl+Space` | 播放/暂停 |
| **TTS 控制** | `Escape` | 停止播放 |
| **TTS 导航** | `Ctrl+←` | 上一句 |
| **TTS 导航** | `Ctrl+→` | 下一句 |
| **TTS 速度** | `Ctrl+↑` | 加速 0.1x |
| **TTS 速度** | `Ctrl+↓` | 减速 0.1x |
| **音频导出** | `Ctrl+Shift+E` | 导出选中文本为音频 |

#### 自定义快捷键
所有命令都可以在 **Settings → Hotkeys** 中重新绑定。

---

### 8. 🧙 新手引导向导

#### 8.1 首次启动
插件安装后会自动弹出 5 步引导向导：

```
Step 1: 欢迎页面
├─ 功能介绍
└─ 开始配置

Step 2: AI 配置
├─ 选择 AI 服务商
├─ 输入 API Key
└─ 测试连接

Step 3: 音频配置（可选）
├─ 启用 TTS
├─ 启用 STT
└─ 配置相关参数

Step 4: 文件夹配置
├─ 视频笔记保存位置
├─ 字幕保存位置
└─ 音频保存位置

Step 5: 完成
├─ 配置总结
└─ 快速提示
```

#### 8.2 配置预设
4 个一键预设方案：

| 预设 | 适用场景 | 启用的功能 |
|------|----------|-----------|
| **🎓 语言学习者** | YouTube 视频学习 | 全功能（AI、TTS、STT） |
| **📝 内容创作者** | 视频笔记记录 | AI 翻译、TTS |
| **🎙️ 播客笔记员** | 音频转文字 | STT、AI 格式化 |
| **🚀 最小配置** | 基础使用 | 仅 AI 翻译 |

---

### 9. 🔍 实时搜索系统

#### 功能
在设置页面顶部有一个搜索框，可以即时筛选所有设置项。

#### 特性
- ✅ **双语搜索**：支持中英文关键词
- ✅ **自动隐藏**：没有匹配项的卡片自动隐藏
- ✅ **高亮显示**：匹配的设置项高亮
- ✅ **即时响应**：输入时实时过滤

#### 使用示例
- 搜索"API"：显示所有 API 相关设置
- 搜索"快捷键"：显示所有快捷键设置
- 搜索"voice"：显示语音相关设置

---

### 10. 📊 知识库问答（Vault QA）

#### 功能说明
基于你的 Obsidian 笔记库，使用 AI 回答问题。

#### 工作原理
```
1. 用户提问
2. 搜索笔记库中相关内容
3. 将相关笔记作为上下文
4. 让 AI 基于这些内容回答
```

#### 配置项
- **搜索文件夹**：指定搜索范围
- **排除文件夹**：排除某些文件夹
- **最大来源数**：引用的笔记数量上限

---

## 🎨 UI/UX 设计亮点

### 1. 双语界面
- **所有标签**：英文/中文 同行显示
- **节省空间**：比传统双语布局节省 50% 垂直空间
- **一致性**：整个插件统一的双语体验

### 2. 状态指示器
- 🟢 **就绪**（Ready）：功能已配置且可用
- 🟠 **警告**（Warning）：配置不完整或可能有问题
- ⚪ **未设置**（Not Set）：功能未启用或未配置

### 3. 卡片式布局
每个功能模块独立成卡片：
```
┌─────────────────────────────┐
│ 🎥 Video Import             │
│                             │
│ [Settings...]               │
│ [Buttons...]                │
└─────────────────────────────┘

┌─────────────────────────────┐
│ 🤖 AI Translation           │
│                             │
│ [Settings...]               │
│ [Test Button]               │
└─────────────────────────────┘
```

### 4. 标签页重组
从 6 个标签精简到 4 个：
- **Content**（内容）：视频导入、笔记模板
- **AI**：AI 服务商配置、自定义命令
- **Audio**（音频）：TTS、STT 配置
- **Advanced**（高级）：高级选项、实验性功能

---

## 🛠️ 技术架构

### 核心技术栈
```
├─ 框架：Obsidian Plugin API
├─ 语言：TypeScript
├─ 构建：esbuild
├─ 样式：原生 CSS（350+ 行）
├─ 音频：Web Audio API
├─ 缓存：IndexedDB
└─ 编辑器：CodeMirror 6
```

### 主要模块
```
src/
├─ ai/                    # AI 相关
│   ├─ learning-assistant.ts  # 学习助手
│   └─ vault-qa.ts        # 知识库问答
├─ tts/                   # 文本转语音
│   ├─ tts-manager.ts     # TTS 核心管理
│   ├─ tts-cache.ts       # IndexedDB 缓存
│   ├─ tts-highlight.ts   # 播放高亮
│   └─ codemirror-extension.ts  # 编辑器扩展
├─ voice/                 # 语音转文字
│   ├─ audio-recorder.ts  # 录音器
│   ├─ transcription-service.ts  # 转录服务
│   └─ recording-modal.ts # 录音界面
├─ copilot/               # 自定义命令
│   ├─ custom-commands.ts # 命令管理
│   └─ command-settings-ui.ts  # 命令设置界面
├─ youtube/               # YouTube 相关
│   ├─ youtube-fetcher.ts # 字幕获取
│   ├─ srt-generator.ts   # SRT 生成
│   └─ youtube-modal.ts   # 输入对话框
├─ translator.ts          # AI 翻译器
├─ types.ts               # 类型定义
└─ utils.ts               # 工具函数
```

---

## 📝 使用场景示例

### 场景 1：YouTube 视频学习
```
1. 找到一个 YouTube 英语教学视频
2. Ctrl+Shift+Y 打开导入对话框
3. 粘贴视频链接
4. 等待 30 秒
5. 打开生成的双语笔记：
   - 阅读中文译文理解大意
   - 对照英文原文学习表达
   - 使用 TTS 朗读练习听力
   - 导出难点句子为音频反复听
```

### 场景 2：口语练习
```
1. 写一段英文自我介绍
2. 选中文本
3. 右键 → English Learner → "口语纠正专家"
4. AI 给出纠正建议
5. 修改后选中
6. Ctrl+Shift+P 朗读
7. 跟读练习
```

### 场景 3：播客笔记
```
1. 听英语播客
2. Ctrl+Shift+R 开始录音
3. 播客结束后停止
4. 自动转录成文字
5. 选中关键句子
6. 右键 → Translate to Chinese
7. 整理成双语笔记
```

### 场景 4：快速翻译
```
1. 绑定"Translate to Chinese"到 Ribbon 按钮
2. 阅读英文文章时遇到难句
3. 选中句子
4. 点击 ⚡ 按钮
5. 中文翻译立即插入
```

---

## ⚙️ 配置建议

### 新手配置（5 分钟入门）
```yaml
AI 服务商: DeepSeek
API Key: 你的 DeepSeek Key（性价比最高）
TTS: 暂不启用（可选功能）
STT: 暂不启用（可选功能）
视频文件夹: 01-Videos
```

### 进阶配置（完整功能）
```yaml
AI 服务商: OpenAI
API Key: 你的 OpenAI Key
TTS: OpenAI（使用同一个 Key）
  - Voice: alloy
  - Model: tts-1
STT: OpenAI Whisper（使用同一个 Key）
视频文件夹: 01-Videos
字幕文件夹: 02-Subtitles
音频文件夹: 03-Resources/aloud
```

### 专业配置（企业级）
```yaml
AI 服务商: OpenAI
  - Key: gpt-xxx
  - Model: gpt-4
TTS: Azure
  - Key: azure-xxx
  - Region: eastus
  - Voice: 自动加载
STT: Azure
  - Key: azure-stt-xxx
  - Region: eastus
缓存: 本地缓存（启用）
自动滚动: 启用
```

---

## 💰 成本估算

### API 调用成本

#### YouTube 视频导入（以 10 分钟视频为例）
```
字幕获取: 免费
AI 翻译: 约 1500 tokens × 2 次 = $0.003 (DeepSeek)
AI 格式化: 约 1500 tokens × 1 次 = $0.0015
总计: ~$0.005 / 10分钟视频
```

#### TTS 使用
```
OpenAI TTS: $0.015 / 1000 字符
Azure TTS: $0.016 / 1000 字符
缓存命中率: ~80%（重复播放几乎免费）
```

#### STT 使用
```
OpenAI Whisper: $0.006 / 分钟
Azure STT: $1.00 / 小时
```

### 月度成本估算（轻度使用）
```
每天导入 2 个视频: $0.01 × 30 = $0.30
每天 TTS 播放 10 分钟: $0.03 × 30 = $0.90
每天录音 5 分钟: $0.03 × 30 = $0.90
总计: ~$2.10 / 月
```

---

## 🔐 隐私与安全

### 数据流向
```
你的电脑 → AI API 服务器 → 返回结果
```

### 数据存储
- ✅ **本地存储**：所有笔记、音频文件存储在本地
- ✅ **缓存隔离**：TTS 缓存使用 IndexedDB，与其他应用隔离
- ✅ **无追踪**：插件不收集任何使用数据
- ✅ **API Key 安全**：存储在 Obsidian 配置文件中（本地）

### 建议
- 使用正规 AI 服务商（OpenAI、Azure、DeepSeek）
- 定期更新 API Key
- 敏感内容避免使用 AI 处理
- 自托管 AI 服务获得更高安全性

---

## 🐛 常见问题

### Q1: YouTube 导入失败？
**A:** 可能原因：
1. 视频无字幕
2. 字幕为自动生成（需手动开启）
3. 网络问题
4. 视频为私有或地区限制

**解决方案**：
- 确认视频有字幕
- 尝试使用 VPN
- 手动下载字幕后导入

### Q2: AI 调用失败？
**A:** 检查：
1. API Key 是否正确
2. 账户余额是否充足
3. API 服务是否可访问
4. 使用"Test Connection"测试

### Q3: TTS 播放卡顿？
**A:** 优化方案：
1. 启用本地缓存
2. 降低播放速度
3. 使用更快的 TTS 模型（如 tts-1 而不是 tts-1-hd）
4. 检查网络连接

### Q4: 自定义命令不显示？
**A:** 检查：
1. 命令文件格式是否正确（.md）
2. frontmatter 格式是否正确
3. `showInContextMenu: true` 是否设置
4. 重新加载 Obsidian

### Q5: 快捷键冲突？
**A:**
1. Settings → Hotkeys
2. 搜索插件名称
3. 重新绑定快捷键
4. 避免与系统快捷键冲突

---

## 🚀 最佳实践

### 1. 文件夹组织
推荐结构：
```
你的 Vault/
├─ 01-Videos/              # 视频笔记
│   ├─ 2025-12-09-xxx.md
│   └─ 2025-12-10-yyy.md
├─ 02-Subtitles/           # 字幕文件
│   ├─ xxx-en.srt
│   ├─ xxx-zh.srt
│   └─ ...
├─ 03-Resources/
│   ├─ aloud/              # TTS 音频
│   ├─ voice-recordings/   # 录音文件
│   ├─ copilot-custom-prompts/  # 自定义命令
│   └─ thumbnails/         # 视频封面
└─ 04-Learning Notes/      # 学习笔记
    ├─ Vocabulary/
    └─ Grammar/
```

### 2. 学习工作流
```
早上：
├─ 导入 1-2 个 YouTube 视频
└─ 快速浏览译文

中午：
├─ 精读视频原文
├─ 使用 TTS 朗读难点句子
└─ 摘录生词和短语

晚上：
├─ 使用自定义命令练习写作
├─ 录音练习口语
└─ 复习当天内容
```

### 3. 提升效率技巧
- **批量导入**：一次导入多个视频，利用碎片时间学习
- **快捷键**：熟练使用快捷键，提高操作效率
- **模板定制**：根据学习目标定制笔记模板
- **缓存利用**：重复播放的内容几乎零成本
- **组合使用**：TTS + 高亮 + 自动滚动 = 沉浸式学习体验

---

## 📈 未来规划

### 即将推出（v1.13.0）
- [ ] Anki 集成：一键导出生词到 Anki
- [ ] 生词本：自动收集和管理生词
- [ ] 学习统计：学习时长、视频数量统计
- [ ] 更多 TTS 服务商：支持 Azure 更多语音

### 长期规划
- [ ] AI 语音对话：与 AI 进行语音对话练习
- [ ] 视频字幕编辑器：可视化编辑字幕时间轴
- [ ] 协作学习：分享学习笔记和资源
- [ ] 移动端支持：iOS/Android 原生体验

---

## 📚 相关文档

- **[完整 README](README.md)** - 项目介绍和安装指南
- **[键盘快捷键指南](KEYBOARD_SHORTCUTS.md)** - 所有快捷键详解
- **[Ribbon 按钮指南](RIBBON_BUTTON_GUIDE.md)** - 快捷按钮配置
- **[代码审查报告](CODE_REVIEW_REPORT.md)** - 代码质量分析

---

## 🎓 总结

**OB-English-Learner** 是一个功能完整、设计精良的英语学习插件。它将：

✅ **视频学习**（YouTube 字幕导入）  
✅ **AI 辅助**（翻译、格式化、自定义命令）  
✅ **语音功能**（TTS 朗读、STT 转录）  
✅ **智能工具**（高亮、缓存、快捷键）

深度整合到 Obsidian 工作流中，为英语学习者提供了一个**一站式的学习工作站**。

### 核心优势
1. 🔄 **自动化流程**：从视频导入到笔记生成全自动
2. 🤖 **AI 赋能**：多场景 AI 辅助，提升学习效率
3. 🎵 **多模态学习**：视觉、听觉、动手全方位
4. ⚡ **高效操作**：快捷键、Ribbon 按钮、右键菜单
5. 🎨 **现代 UI**：双语界面、卡片布局、状态指示

### 适用人群
- 📚 英语学习者（各个水平）
- 🎬 视频课程学习者
- 🎙️ 播客爱好者
- ✍️ 内容创作者
- 👨‍🏫 英语教师

---

**让 Obsidian 成为你的智能英语学习工作站！** 🚀📖✨
