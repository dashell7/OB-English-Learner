# é‡å¤å¯¼å…¥æ£€æµ‹åŠŸèƒ½

## ğŸ”„ åŠŸèƒ½æ¦‚è¿°

å½“æ‚¨å°è¯•å¯¼å…¥å·²ç»å¯¼å…¥è¿‡çš„è§†é¢‘æ—¶ï¼ŒLinguaSync ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¿›å…¥**æ›´æ–°æ¨¡å¼**ï¼Œåªæ›´æ–° Markdown æ–‡æ¡£å†…å®¹ï¼Œè€Œä¸é‡æ–°ç”Ÿæˆå°é¢å›¾ç‰‡å’Œå­—å¹•æ–‡ä»¶ã€‚

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. æ›´æ–°ç¬”è®°å†…å®¹
- ä¿®æ”¹äº†æ¨¡æ¿åï¼Œæƒ³é‡æ–°ç”Ÿæˆç¬”è®°å†…å®¹
- è°ƒæ•´äº† Frontmatter å±æ€§ï¼Œæƒ³åº”ç”¨åˆ°å·²å¯¼å…¥çš„è§†é¢‘
- é‡æ–°è·å–æœ€æ–°çš„è§†é¢‘å…ƒæ•°æ®ï¼ˆå¦‚ä¿®æ”¹åçš„æ ‡é¢˜ã€æè¿°ç­‰ï¼‰

### 2. ä¿æŠ¤ç°æœ‰èµ„æº
- é¿å…é‡å¤ä¸‹è½½å°é¢å›¾ç‰‡ï¼ˆèŠ‚çœç½‘ç»œæµé‡ï¼‰
- é¿å…é‡æ–°ç”Ÿæˆå­—å¹•æ–‡ä»¶ï¼ˆèŠ‚çœæ—¶é—´ï¼‰
- ä¿æŒæ–‡ä»¶å¤¹ç»“æ„æ•´æ´ï¼Œä¸äº§ç”Ÿé‡å¤æ–‡ä»¶

### 3. å¿«é€Ÿè¿­ä»£
- è°ƒè¯•æ¨¡æ¿è®¾è®¡æ—¶å¯ä»¥å¿«é€Ÿæµ‹è¯•
- ä¸ç”¨æ‹…å¿ƒè¯¯å¯¼å…¥äº§ç”Ÿå¤§é‡é‡å¤èµ„æº

## ğŸ” æ£€æµ‹æœºåˆ¶

### æ£€æµ‹æ–¹å¼
ç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æ­¥éª¤æ£€æµ‹é‡å¤ï¼š

1. **æå–è§†é¢‘ ID**
   - YouTube: ä»å„ç§ URL æ ¼å¼ä¸­æå– 11 ä½ videoId
   - Bilibili: æå– BV å·

2. **æ‰«æå·²æœ‰ç¬”è®°**
   - éå† `videoFolder` ä¸­çš„æ‰€æœ‰ Markdown æ–‡ä»¶
   - è¯»å–æ¯ä¸ªæ–‡ä»¶çš„ Frontmatter

3. **URL åŒ¹é…**
   - æå– `url` å±æ€§å¹¶è§„èŒƒåŒ–
   - æ¯”è¾ƒ videoId æ˜¯å¦ç›¸åŒ

### URL è§„èŒƒåŒ–
ä¸åŒæ ¼å¼çš„ URL ä¼šè¢«è¯†åˆ«ä¸ºåŒä¸€è§†é¢‘ï¼š

```
âœ… ç›¸åŒè§†é¢‘ - ä¼šè§¦å‘æ›´æ–°æ¨¡å¼ï¼š
https://www.youtube.com/watch?v=dQw4w9WgXcQ
https://youtu.be/dQw4w9WgXcQ
https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=30s
https://m.youtube.com/watch?v=dQw4w9WgXcQ
```

## ğŸ”„ æ›´æ–°æ¨¡å¼å·¥ä½œæµç¨‹

### æ­£å¸¸å¯¼å…¥ï¼ˆæ–°è§†é¢‘ï¼‰
```
1. Extract ID â”â”â”â”â”â”â”â”â”â”â”â”â”â–¶ æå–è§†é¢‘ ID
2. Check duplicate â”â”â”â”â”â”â–¶ æ£€æŸ¥æ˜¯å¦é‡å¤ âŒ ä¸é‡å¤
3. Fetch transcript â”â”â”â”â”â–¶ è·å–å­—å¹•
4. Detect language â”â”â”â”â”â”â–¶ æ£€æµ‹è¯­è¨€
5. AI translate â”â”â”â”â”â”â”â”â–¶ AI ç¿»è¯‘ï¼ˆå¦‚å¯ç”¨ï¼‰
6. Create folders â”â”â”â”â”â”â–¶ åˆ›å»ºæ–‡ä»¶å¤¹
7. Generate SRTs â”â”â”â”â”â”â”â–¶ ç”Ÿæˆå­—å¹•æ–‡ä»¶
8. Download thumbnail â”â”â”â–¶ ä¸‹è½½å°é¢å›¾ç‰‡
9. Create note â”â”â”â”â”â”â”â”â”â–¶ åˆ›å»º Markdown ç¬”è®°

ç»“æœ: âœ¨ åˆ›å»ºæ–°ç¬”è®° + æ‰€æœ‰èµ„æº
```

### æ›´æ–°å¯¼å…¥ï¼ˆé‡å¤è§†é¢‘ï¼‰
```
1. Extract ID â”â”â”â”â”â”â”â”â”â”â”â”â”â–¶ æå–è§†é¢‘ ID
2. Check duplicate â”â”â”â”â”â”â–¶ æ£€æŸ¥æ˜¯å¦é‡å¤ âœ… å‘ç°é‡å¤!
3. Fetch transcript â”â”â”â”â”â–¶ é‡æ–°è·å–æœ€æ–°å­—å¹•
4. Detect language â”â”â”â”â”â”â–¶ æ£€æµ‹è¯­è¨€
5. AI translate â”â”â”â”â”â”â”â”â–¶ AI ç¿»è¯‘ï¼ˆå¦‚å¯ç”¨ï¼‰
6. â­ï¸ SKIP: Generate SRTs â”â–¶ è·³è¿‡ï¼å¤ç”¨ç°æœ‰å­—å¹•æ–‡ä»¶
7. â­ï¸ SKIP: Download cover â”â–¶ è·³è¿‡ï¼å¤ç”¨ç°æœ‰å°é¢
8. Update note â”â”â”â”â”â”â”â”â”â–¶ è¦†ç›–æ›´æ–° Markdown å†…å®¹

ç»“æœ: ğŸ”„ æ›´æ–°ç¬”è®°å†…å®¹ï¼Œä¿ç•™åŸæœ‰èµ„æº
```

## ğŸ’¾ èµ„æºå¤ç”¨æœºåˆ¶

### å¤ç”¨å°é¢å›¾ç‰‡
ä»ç°æœ‰ç¬”è®°çš„ Frontmatter ä¸­æå–ï¼š
```yaml
cover: "[[VideoTitle/cover-xxx.jpg]]"
```

### å¤ç”¨å­—å¹•æ–‡ä»¶
ä»ç°æœ‰ç¬”è®°å†…å®¹ä¸­æå– SRT æ–‡ä»¶è·¯å¾„ï¼š
```markdown
- English: [[VideoTitle/Subtitles/VideoTitle - EN.srt]]
- ä¸­æ–‡: [[VideoTitle/Subtitles/VideoTitle - ZH.srt]]
- EN-ZH: [[VideoTitle/Subtitles/VideoTitle - EN-ZH.srt]]
```

### æ™ºèƒ½åŒ¹é…
- è‡ªåŠ¨è¯†åˆ«å·²æœ‰çš„è‹±æ–‡ã€ä¸­æ–‡ã€åŒè¯­å­—å¹•
- ä¿æŒåŸæœ‰çš„æ–‡ä»¶å‘½åå’Œè·¯å¾„ç»“æ„
- ç¡®ä¿å†…éƒ¨é“¾æ¥ä¸ä¼šå¤±æ•ˆ

## ğŸ“Š å¯¹æ¯”ç¤ºä¾‹

### åœºæ™¯ï¼šä¿®æ”¹æ¨¡æ¿åé‡æ–°å¯¼å…¥

**ç¬¬ä¸€æ¬¡å¯¼å…¥**ï¼ˆ2024-11-01ï¼‰ï¼š
```yaml
---
type: video-note
status: inbox
title: "How to Learn English"
channel: "English Academy"
---
```

**ä¿®æ”¹æ¨¡æ¿**ï¼ˆ2024-11-24ï¼‰ï¼š
```yaml
---
title: "How to Learn English"  # â† æ–°é¡ºåº
langr: How to Learn English    # â† æ–°å±æ€§
date: 2024-11-24               # â† æ–°å±æ€§
cefr: B2                       # â† æ–°å±æ€§
cover: "[[...]]"
channel: "English Academy"
url: https://...
---
```

**é‡æ–°å¯¼å…¥ç›¸åŒè§†é¢‘**ï¼š
- âœ… ç¬”è®°å†…å®¹æ›´æ–°ä¸ºæ–°æ¨¡æ¿
- âœ… Frontmatter åŒ…å«æ–°å±æ€§
- âœ… å°é¢å›¾ç‰‡ä¸é‡æ–°ä¸‹è½½ï¼ˆå¤ç”¨ï¼‰
- âœ… å­—å¹•æ–‡ä»¶ä¸é‡æ–°ç”Ÿæˆï¼ˆå¤ç”¨ï¼‰
- â±ï¸ å¯¼å…¥é€Ÿåº¦å¿« 3-5 å€

## ğŸ›ï¸ æ§åˆ¶å°è¾“å‡º

### æ–°å»ºæ¨¡å¼
```
[LinguaSync] Fetching transcript...
[LinguaSync] ğŸ“¥ Creating new note with all assets...
[LinguaSync] Downloading thumbnail...
[LinguaSync] Creating EN SRT...
[LinguaSync] Creating ZH SRT...
[LinguaSync] âœ… Note created: How to Learn English
```

### æ›´æ–°æ¨¡å¼
```
[LinguaSync] Found existing note: How to Learn English
[LinguaSync] ğŸ”„ Video already imported, updating note only...
[LinguaSync] ğŸ”„ Update mode: Reusing existing assets...
[LinguaSync] âœ… Reusing cover: How to Learn English/cover-abc.jpg
[LinguaSync] âœ… Reusing EN SRT: How to Learn English - EN.srt
[LinguaSync] âœ… Reusing ZH SRT: How to Learn English - ZH.srt
[LinguaSync] âœ… Note updated: How to Learn English
```

## ğŸ”” ç”¨æˆ·æç¤º

### è¿›åº¦é€šçŸ¥
æ›´æ–°æ¨¡å¼ä¸‹çš„è¿›åº¦æç¤ºï¼š

```
ğŸ¬ Video already exists, updating...    85%
   â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°â–±â–±â–±â–±
```

### æˆåŠŸæ¶ˆæ¯
- æ–°å»ºï¼šâœ“ Created: [ç¬”è®°åç§°]
- æ›´æ–°ï¼šâœ“ Updated: [ç¬”è®°åç§°]

## âš™ï¸ æŠ€æœ¯å®ç°

### æŸ¥æ‰¾å·²å­˜åœ¨ç¬”è®°
```typescript
async findExistingNote(url: string, videoId: string): Promise<TFile | null> {
    // 1. è·å–è§†é¢‘æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰ Markdown æ–‡ä»¶
    const files = this.app.vault.getMarkdownFiles();
    
    // 2. éå†å¹¶æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶çš„ Frontmatter
    for (const file of files) {
        if (!file.path.startsWith(videoFolder)) continue;
        
        const content = await this.app.vault.read(file);
        const urlMatch = content.match(/^url:\s*(.+)$/m);
        
        // 3. æ¯”è¾ƒè§„èŒƒåŒ–åçš„ URLï¼ˆé€šè¿‡ videoIdï¼‰
        if (this.normalizeVideoUrl(existingUrl) === this.normalizeVideoUrl(url)) {
            return file;
        }
    }
    
    return null;
}
```

### URL è§„èŒƒåŒ–
```typescript
normalizeVideoUrl(url: string): string {
    // æå– videoId ç”¨äºæ¯”è¾ƒ
    const videoId = YouTubeScraper.extractVideoId(url);
    return videoId || url;
}
```

### èµ„æºå¤ç”¨
```typescript
if (isUpdate && existingNote) {
    // ä»ç°æœ‰ç¬”è®°æå–èµ„æºè·¯å¾„
    const existingContent = await this.app.vault.read(existingNote);
    
    // æå–å°é¢
    const coverMatch = existingContent.match(/^cover:\s*"?\[\[(.+?)\]\]"?$/m);
    coverPath = coverMatch ? coverMatch[1] : '';
    
    // æå–å­—å¹•æ–‡ä»¶
    const enSrtMatch = existingContent.match(/English:\s*\[\[(.+?\.srt)\]\]/);
    srtPaths.english = enSrtMatch ? enSrtMatch[1].split('/').pop() : '';
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ¨¡æ¿è¿­ä»£å¼€å‘
```
1. è®¾è®¡æ–°æ¨¡æ¿
2. ç”¨ä¸€ä¸ªæµ‹è¯•è§†é¢‘å¯¼å…¥
3. æŸ¥çœ‹æ•ˆæœ
4. è°ƒæ•´æ¨¡æ¿
5. é‡æ–°å¯¼å…¥ç›¸åŒè§†é¢‘ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
6. é‡å¤æ­¥éª¤ 3-5 ç›´åˆ°æ»¡æ„
```

### 2. æ‰¹é‡æ›´æ–°ç°æœ‰ç¬”è®°
```
æƒ³è¦å°†æ–°æ¨¡æ¿åº”ç”¨åˆ°å·²æœ‰çš„ 50 ä¸ªè§†é¢‘ç¬”è®°ï¼Ÿ
â†’ é€ä¸ªé‡æ–°å¯¼å…¥ç›¸åŒçš„ URL
â†’ è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç¬”è®°
â†’ ä¸äº§ç”Ÿé‡å¤èµ„æº
```

### 3. ä¿®å¤æŸåçš„ç¬”è®°
```
å¦‚æœæŸä¸ªç¬”è®°å†…å®¹æœ‰é—®é¢˜ï¼š
â†’ ç›´æ¥é‡æ–°å¯¼å…¥
â†’ å†…å®¹è¢«é‡æ–°ç”Ÿæˆ
â†’ å°é¢å’Œå­—å¹•ä¿æŒä¸å˜
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸ä¼šæ›´æ–°çš„å†…å®¹
- âŒ å°é¢å›¾ç‰‡ï¼ˆé™¤éæ‰‹åŠ¨åˆ é™¤ï¼‰
- âŒ å­—å¹•æ–‡ä»¶ï¼ˆé™¤éæ‰‹åŠ¨åˆ é™¤ï¼‰
- âŒ æ–‡ä»¶å¤¹ç»“æ„

### ä¼šæ›´æ–°çš„å†…å®¹
- âœ… Markdown æ–‡æ¡£çš„å…¨éƒ¨å†…å®¹
- âœ… Frontmatter å±æ€§
- âœ… æ­£æ–‡æ ¼å¼å’Œå¸ƒå±€
- âœ… è§†é¢‘å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€æ—¶é•¿ç­‰ï¼‰

### æ‰‹åŠ¨å¼ºåˆ¶é‡æ–°ç”Ÿæˆ
å¦‚æœæ‚¨ç¡®å®æƒ³é‡æ–°ç”Ÿæˆæ‰€æœ‰èµ„æºï¼š

```
1. åˆ é™¤æ•´ä¸ªè§†é¢‘æ–‡ä»¶å¤¹ï¼ˆåŒ…å«ç¬”è®°ã€å°é¢ã€å­—å¹•ï¼‰
2. é‡æ–°å¯¼å…¥è§†é¢‘
3. æ‰€æœ‰èµ„æºå°†é‡æ–°ç”Ÿæˆ
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¯¼å…¥é€Ÿåº¦å¯¹æ¯”
| æ“ä½œ | æ–°å»ºæ¨¡å¼ | æ›´æ–°æ¨¡å¼ | æå‡ |
|------|---------|---------|------|
| ä¸‹è½½å°é¢ | 2-5s | 0s | â­ï¸ è·³è¿‡ |
| ç”Ÿæˆå­—å¹• | 1-3s | 0s | â­ï¸ è·³è¿‡ |
| åˆ›å»ºç¬”è®° | 1s | 1s | - |
| **æ€»è®¡** | **4-9s** | **~1s** | **4-8å€** âš¡ |

### èµ„æºèŠ‚çœ
- ç½‘ç»œæµé‡ï¼šèŠ‚çœå°é¢å›¾ç‰‡ä¸‹è½½ï¼ˆæ¯æ¬¡ ~500KBï¼‰
- ç£ç›˜ç©ºé—´ï¼šé¿å…é‡å¤æ–‡ä»¶
- CPU ä½¿ç”¨ï¼šå‡å°‘æ–‡ä»¶ I/O æ“ä½œ

## ğŸ‰ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: è°ƒè¯•æ¨¡æ¿
```
1. å¯¼å…¥è§†é¢‘: https://youtu.be/abc123
   â†’ åˆ›å»ºç¬”è®° + æ‰€æœ‰èµ„æº
   
2. å‘ç°æ¨¡æ¿æœ‰é”™è¯¯ï¼Œä¿®æ”¹æ¨¡æ¿

3. å†æ¬¡å¯¼å…¥: https://youtu.be/abc123
   â†’ ğŸ”„ æ£€æµ‹åˆ°é‡å¤
   â†’ æ›´æ–°ç¬”è®°ï¼ˆ1ç§’ï¼‰
   â†’ å®Œæˆï¼
```

### ç¤ºä¾‹ 2: åº”ç”¨æ–°å±æ€§
```
1. æ·»åŠ äº† CEFR å±æ€§åˆ°æ¨¡æ¿

2. é‡æ–°å¯¼å…¥å·²æœ‰çš„ 30 ä¸ªè§†é¢‘
   â†’ æ¯ä¸ªåªéœ€ 1 ç§’
   â†’ æ‰€æœ‰ç¬”è®°åŒ…å«æ–°å±æ€§
   â†’ åŸæœ‰èµ„æºå®Œæ•´ä¿ç•™
```

### ç¤ºä¾‹ 3: å¤šè®¾å¤‡åŒæ­¥
```
è®¾å¤‡ A: å¯¼å…¥è§†é¢‘ + ç”Ÿæˆèµ„æº
è®¾å¤‡ B: åŒæ­¥åé‡æ–°å¯¼å…¥
   â†’ ğŸ”„ æ£€æµ‹åˆ°é‡å¤
   â†’ åªæ›´æ–°ç¬”è®°å†…å®¹
   â†’ ç¡®ä¿ä¸¤ç«¯ä¸€è‡´
```

## ğŸ”® æœªæ¥æ”¹è¿›

å¯èƒ½çš„åŠŸèƒ½å¢å¼ºï¼š

- [ ] å¯é…ç½®ï¼šé€‰æ‹©æ˜¯å¦åœ¨æ›´æ–°æ—¶é‡æ–°ç”Ÿæˆå­—å¹•
- [ ] å·®å¼‚å¯¹æ¯”ï¼šæ˜¾ç¤ºç¬”è®°å†…å®¹çš„å˜åŒ–
- [ ] æ‰¹é‡æ›´æ–°ï¼šä¸€é”®æ›´æ–°æ‰€æœ‰å·²å¯¼å…¥è§†é¢‘
- [ ] ç‰ˆæœ¬å†å²ï¼šä¿ç•™æ—§ç‰ˆæœ¬çš„ç¬”è®°

---

**æç¤º**: è¿™ä¸ªåŠŸèƒ½å®Œå…¨è‡ªåŠ¨ï¼Œæ‚¨ä¸éœ€è¦åšä»»ä½•é…ç½®ï¼åªéœ€æ­£å¸¸å¯¼å…¥è§†é¢‘å³å¯ã€‚âœ¨
